const i18n = {
  en: {
    nav_services: 'Services', nav_how: 'How it works', nav_partners: 'Providers', nav_book: 'Book Now',
    hero_title: 'Trusted local services, fast.',
    hero_sub: 'AC servicing and home cleaning in Dhaka, with quick response and verified providers.',
    hero_book: 'Book a Service', hero_join: 'Join as Provider',
    services_title: 'Launch Services (V1)', ac_title: 'AC Servicing',
    ac_desc: 'General service, gas check/refill, cooling diagnosis, urgent repair.',
    clean_title: 'Home Cleaning', clean_desc: 'Deep cleaning, move-in/move-out cleanup, kitchen and bathroom intensive service.',
    how_title: 'How it works', how_1: 'Submit your service request.', how_2: 'We match you with a verified provider in your area.', how_3: 'Provider confirms timing and completes the job.',
    form_title: 'Book a Service', form_sub: 'Fill this quick form and we’ll route your request to the right provider.',
    label_name: 'Full Name', label_phone: 'Phone / WhatsApp', label_company: 'Company / Brand', label_service: 'Service Type', label_budget: 'Budget Range', label_timeline: 'Timeline', label_area: 'Area',
    label_time: 'Preferred Time', label_notes: 'Problem / Notes (min 30 chars)', btn_submit: 'Submit Request',
    form_note: 'By submitting, you agree to be contacted by ShojaBD or its service partners.', rights: 'All rights reserved.',
    p_title: 'Join as a Service Provider', p_sub: 'We send ready customer leads to service providers in Dhaka. Start with a trial.',
    p_earn_title: 'How partners earn', p_earn_1: 'Pay per qualified lead or monthly package', p_earn_2: 'Area and service filtered leads', p_earn_3: 'More leads for high performers',
    p_std_title: 'Provider standards', p_std_1: 'Fast response (5–10 min)', p_std_2: 'Transparent pricing', p_std_3: 'Professional behavior and quality work',
    p_apply: 'Apply Now', p_business: 'Business Name', p_contact: 'Contact Person', p_phone: 'Phone / WhatsApp', p_service: 'Primary Service', p_area: 'Coverage Areas', p_submit: 'Submit Application',
    opt_select: 'Select one'
  },
  bn: {
    nav_services: 'সার্ভিস', nav_how: 'কীভাবে কাজ করে', nav_partners: 'প্রোভাইডার', nav_book: 'এখনই বুক করুন',
    hero_title: 'দ্রুত বিশ্বস্ত লোকাল সার্ভিস',
    hero_sub: 'ঢাকায় AC সার্ভিসিং এবং হোম ক্লিনিং—দ্রুত রেসপন্স, ভেরিফায়েড প্রোভাইডার, এবং ফেয়ার প্রাইস।',
    hero_book: 'সার্ভিস বুক করুন', hero_join: 'প্রোভাইডার হিসেবে যোগ দিন',
    services_title: 'শুরুতে যে সার্ভিসগুলো', ac_title: 'AC সার্ভিসিং',
    ac_desc: 'জেনারেল সার্ভিস, গ্যাস চেক/রিফিল, কুলিং সমস্যা ডায়াগনসিস, জরুরি রিপেয়ার।',
    clean_title: 'হোম ক্লিনিং', clean_desc: 'ডিপ ক্লিনিং, মুভ-ইন/মুভ-আউট ক্লিনআপ, কিচেন ও বাথরুম ইনটেনসিভ সার্ভিস।',
    how_title: 'কীভাবে কাজ করে', how_1: 'আপনি সার্ভিস রিকোয়েস্ট সাবমিট করেন।', how_2: 'আমরা আপনার এরিয়ার ভেরিফায়েড প্রোভাইডারের সাথে ম্যাচ করি।', how_3: 'প্রোভাইডার সময় কনফার্ম করে কাজ সম্পন্ন করে।',
    form_title: 'সার্ভিস বুকিং ফর্ম', form_sub: 'ফর্মটি পূরণ করুন, আমরা দ্রুত সঠিক প্রোভাইডারের কাছে রিকোয়েস্ট পাঠিয়ে দেব।',
    label_name: 'পূর্ণ নাম', label_phone: 'ফোন / WhatsApp', label_company: 'কোম্পানি / ব্র্যান্ড', label_service: 'সার্ভিস টাইপ', label_budget: 'বাজেট রেঞ্জ', label_timeline: 'কবে দরকার', label_area: 'এরিয়া',
    label_time: 'পছন্দের সময়', label_notes: 'সমস্যা / নোটস (কমপক্ষে ৩০ অক্ষর)', btn_submit: 'রিকোয়েস্ট সাবমিট করুন',
    form_note: 'সাবমিট করলে ShojaBD বা আমাদের পার্টনার আপনার সাথে যোগাযোগ করতে পারবে।', rights: 'সর্বস্বত্ব সংরক্ষিত।',
    p_title: 'প্রোভাইডার হিসেবে যোগ দিন', p_sub: 'আমরা ঢাকায় সার্ভিস প্রোভাইডারদের জন্য রেডি কাস্টমার লিড পাঠাই। প্রথমে ট্রায়াল দিয়ে শুরু করুন।',
    p_earn_title: 'কীভাবে আয় হবে', p_earn_1: 'প্রতি কুয়ালিফায়েড লিড বা মাসিক প্যাকেজ', p_earn_2: 'এরিয়া ও সার্ভিসভিত্তিক লিড', p_earn_3: 'ভালো পারফরমেন্সে বেশি লিড',
    p_std_title: 'প্রোভাইডার স্ট্যান্ডার্ড', p_std_1: 'দ্রুত রেসপন্স (৫–১০ মিনিট)', p_std_2: 'স্বচ্ছ মূল্য', p_std_3: 'পেশাদার আচরণ ও মানসম্পন্ন কাজ',
    p_apply: 'এখনই আবেদন করুন', p_business: 'ব্যবসার নাম', p_contact: 'কন্টাক্ট পারসন', p_phone: 'ফোন / WhatsApp', p_service: 'প্রধান সার্ভিস', p_area: 'কভারেজ এরিয়া', p_submit: 'আবেদন সাবমিট করুন',
    opt_select: 'একটি বেছে নিন'
  }
};

function setLang(lang) {
  document.documentElement.lang = lang;
  document.querySelectorAll('[data-i18n]').forEach((el) => {
    const key = el.getAttribute('data-i18n');
    if (i18n[lang][key]) {
      const hasInput = el.querySelector && el.querySelector('input,select,textarea');
      if (!hasInput) el.textContent = i18n[lang][key];
      else el.childNodes[0].nodeValue = i18n[lang][key] + '\n            ';
    }
  });

  const toggle = document.getElementById('langToggle');
  if (toggle) toggle.textContent = lang === 'bn' ? 'English' : 'বাংলা';
  localStorage.setItem('shojabd_lang', lang);
}

document.getElementById('year').textContent = new Date().getFullYear();
const saved = localStorage.getItem('shojabd_lang') || 'bn';
setLang(saved);

const toggle = document.getElementById('langToggle');
if (toggle) {
  toggle.addEventListener('click', () => {
    const current = localStorage.getItem('shojabd_lang') || 'bn';
    const next = current === 'bn' ? 'en' : 'bn';
    setLang(next);
    setupWhatsAppLinks(next);
  });
}

const WA_NUMBER = '8801313399918';

function setupWhatsAppLinks(lang = localStorage.getItem('shojabd_lang') || 'bn') {
  const hasBookingForm = !!document.getElementById('leadForm');
  const targetUrl = hasBookingForm ? '#book' : 'index.html#book';

  const waFloat = document.getElementById('whatsappFloat');
  const waHeader = document.getElementById('whatsappHeader');

  if (waFloat) {
    waFloat.href = targetUrl;
    waFloat.textContent = lang === 'bn' ? 'ফর্ম পূরণ করে WhatsApp' : 'Fill Form → WhatsApp';
  }
  if (waHeader) {
    waHeader.href = targetUrl;
    waHeader.textContent = lang === 'bn' ? 'ফর্ম দিয়ে শুরু করুন' : 'Start with Form';
  }
}

setupWhatsAppLinks(saved);

document.querySelectorAll('.lead-form').forEach((form) => {
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const data = new FormData(form);
    const leadRef = `SHJ-${new Date().toISOString().slice(0, 10).replace(/-/g, '')}-${Math.random().toString(36).slice(2, 6).toUpperCase()}`;
    data.append('lead_ref', leadRef);

    try {
      await fetch(form.action, {
        method: 'POST',
        body: data,
        headers: { 'Accept': 'application/json' }
      });
    } catch (_) {}

    const name = data.get('name') || data.get('contact_person') || '';
    const company = data.get('company') || data.get('business_name') || '';
    const phone = data.get('phone') || '';
    const service = data.get('service') || '';
    const budget = data.get('budget') || '';
    const timeline = data.get('timeline') || '';
    const area = data.get('area') || data.get('areas') || '';
    const notes = data.get('notes') || '';
    const time = data.get('time') || '';

    const lang = localStorage.getItem('shojabd_lang') || 'bn';
    const messageText = lang === 'bn'
      ? `Lead Intake (ShojaBD)\nRef: ${leadRef}\nনাম: ${name}\nকোম্পানি: ${company}\nফোন: ${phone}\nসার্ভিস: ${service}\nবাজেট: ${budget}\nটাইমলাইন: ${timeline}\nএরিয়া: ${area}\nপছন্দের সময়: ${time}\nপ্রয়োজন: ${notes}`
      : `Lead Intake (ShojaBD)\nRef: ${leadRef}\nName: ${name}\nCompany: ${company}\nPhone: ${phone}\nService: ${service}\nBudget: ${budget}\nTimeline: ${timeline}\nArea: ${area}\nPreferred Time: ${time}\nNeed: ${notes}`;

    window.open(`https://wa.me/${WA_NUMBER}?text=${encodeURIComponent(messageText)}`, '_blank');
    alert(lang === 'bn' ? 'ধন্যবাদ। আপনার তথ্য নেওয়া হয়েছে এবং WhatsApp-এ রেডি মেসেজ খোলা হয়েছে।' : 'Thanks. Your details were captured and WhatsApp opened with a ready message.');
    form.reset();
  });
});
